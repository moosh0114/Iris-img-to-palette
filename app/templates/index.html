<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Iris Img to Palette</title>
    <script>
      window.tailwind = window.tailwind || {};
      window.tailwind.config = { darkMode: "class" };
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  </head>
  <body
    x-data="appState()"
    :class="{ dark: isDark }"
    class="m-0 bg-slate-50 font-sans text-slate-800 transition-colors duration-200 ease-in-out dark:bg-slate-900 dark:text-slate-100"
  >
    <div class="mx-auto max-w-[1100px] p-6" x-data="uploader()">
      <div class="flex flex-wrap items-baseline justify-between gap-4">
        <h1 class="m-0 text-xl">Iris Img to Palette</h1>
        <button
          class="inline-flex cursor-pointer items-center gap-2 rounded-[9px] border border-slate-300 bg-slate-200 px-3 py-[9px] text-slate-800 disabled:cursor-not-allowed disabled:opacity-60 dark:border-slate-700 dark:bg-slate-700 dark:text-slate-100"
          type="button"
          @click="toggleTheme()"
        >
          <span x-text="isDark ? 'Switch to Light' : 'Switch to Dark'"></span>
        </button>
      </div>
      <div class="text-[13px] text-slate-600 dark:text-slate-300">FastAPI + HTMX + Alpine.js - results saved to SQLite</div>

      <div class="mt-4 grid grid-cols-1 gap-4 min-[981px]:grid-cols-[1fr_1fr_360px]">
        <div class="rounded-[10px] border border-slate-300 bg-white p-3 dark:border-slate-700 dark:bg-slate-800">
          <div class="mb-[10px] text-[13px] text-slate-600 dark:text-slate-300">
            Upload an image and extract dominant colors (HEX + OKLCH).
          </div>

          <form
            hx-post="/api/extract"
            hx-target="#result"
            hx-swap="innerHTML"
            hx-indicator="#busy"
            enctype="multipart/form-data"
          >
            <label class="mb-[6px] mt-[10px] block text-[13px] text-slate-800 dark:text-slate-100">Image</label>
            <input
              class="box-border w-full rounded-lg border border-slate-300 bg-white p-2 text-slate-800 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"
              name="image"
              type="file"
              accept="image/*"
              required
              @change="onPick($event)"
            />

            <label class="mb-[6px] mt-[10px] block text-[13px] text-slate-800 dark:text-slate-100">n_colors</label>
            <input
              class="box-border w-full rounded-lg border border-slate-300 bg-white p-2 text-slate-800 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"
              name="n_colors"
              type="number"
              min="1"
              max="12"
              value="3"
            />

            <button
              class="mt-3 inline-flex cursor-pointer items-center gap-2 rounded-[9px] border border-slate-300 bg-slate-200 px-3 py-[9px] text-slate-800 disabled:cursor-not-allowed disabled:opacity-60 dark:border-slate-700 dark:bg-slate-700 dark:text-slate-100"
              type="submit"
            >
              Extract
            </button>
            <span id="busy" class="htmx-indicator text-[13px] text-slate-600 dark:text-slate-300" hx-indicator>Working...</span>
          </form>
        </div>

        <div class="rounded-[10px] border border-slate-300 bg-white p-3 dark:border-slate-700 dark:bg-slate-800">
          <div class="mb-[10px] text-[13px] text-slate-600 dark:text-slate-300">Preview</div>
          <template x-if="previewUrl">
            <img
              class="max-h-[360px] w-full rounded-[10px] border border-slate-300 bg-slate-100 object-contain dark:border-slate-700 dark:bg-slate-900"
              :src="previewUrl"
              alt="preview"
            />
          </template>
          <template x-if="!previewUrl">
            <div class="text-[13px] text-slate-600 dark:text-slate-300">No image selected.</div>
          </template>
        </div>

        <div class="rounded-[10px] border border-slate-300 bg-white p-3 dark:border-slate-700 dark:bg-slate-800">
          <div class="mb-[10px] flex items-center justify-between gap-[10px]">
            <div class="text-[13px] text-slate-600 dark:text-slate-300">History</div>
            <button
              class="inline-flex cursor-pointer items-center gap-2 rounded-[9px] border border-slate-300 bg-slate-200 px-[10px] py-[6px] text-xs text-slate-800 disabled:cursor-not-allowed disabled:opacity-60 dark:border-slate-700 dark:bg-slate-700 dark:text-slate-100"
              type="button"
              hx-post="/api/history/clear"
              hx-target="#history"
              hx-swap="innerHTML"
              hx-confirm="Clear all history records?"
            >
              Clear History
            </button>
          </div>
          <div id="history" hx-get="/history" hx-trigger="load" hx-swap="innerHTML">
            <div class="text-[13px] text-slate-600 dark:text-slate-300">Loading...</div>
          </div>
        </div>
      </div>

      <div class="mt-4">
        <div class="rounded-[10px] border border-slate-300 bg-white p-3 dark:border-slate-700 dark:bg-slate-800" id="result">
          <div class="text-[13px] text-slate-600 dark:text-slate-300">Result will appear here.</div>
        </div>
      </div>
    </div>

    <script>
      function appState() {
        return {
          isDark: false,
          toggleTheme() {
            this.isDark = !this.isDark;
          },
        };
      }

      function uploader() {
        return {
          previewUrl: "",
          onPick(e) {
            const f = e?.target?.files?.[0];
            if (!f) {
              this.previewUrl = "";
              return;
            }
            this.previewUrl = URL.createObjectURL(f);
          },
        };
      }
    </script>
  </body>
</html>
